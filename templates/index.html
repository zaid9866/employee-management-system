{% extends 'base.html' %}

{% block title %}Dashboard{% endblock title %}

{% block body %}
<style>
  /* Dark Mode Styles */
  body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
  }
  body.dark-mode .card {
    background-color: #1e1e1e;
    border-color: #333;
  }
  body.dark-mode .table {
    color: #e0e0e0;
  }
  body.dark-mode .table thead {
    background-color: #333;
  }
  body.dark-mode .btn-dark-mode {
    background-color: #f5f5f5;
    color: #121212;
  }
  /* Custom CSS for Analytics Cards */
  .analytics-card {
    border-radius: 12px;
    transition: transform 0.2s ease-in-out;
  }
  .analytics-card:hover {
    transform: scale(1.03);
  }
  /* Search Input */
  #searchInput {
    border-radius: 50px;
    padding: 10px 20px;
    border: 1px solid #ccc;
    box-shadow: none;
  }
</style>

<div class="container mt-4">
  <!-- Header & Dark Mode Toggle -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">Employee Dashboard</h2>
    <button class="btn btn-dark-mode fw-bold" onclick="toggleDarkMode()">Toggle Dark Mode</button>
  </div>

  <!-- Analytics Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card analytics-card shadow border-0 p-3 text-center">
        <h5 class="text-secondary">Total Employees</h5>
        <h2 class="fw-bold">{{ employees|length }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card analytics-card shadow border-0 p-3 text-center">
        <h5 class="text-secondary">Active Employees</h5>
        <h2 class="fw-bold">{{ employees | selectattr('is_active', 'equalto', True) | list | length }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card analytics-card shadow border-0 p-3 text-center">
        <h5 class="text-secondary">Departments</h5>
        <h2 class="fw-bold">{{ departments | length }}</h2>
      </div>
    </div>
  </div>

  <!-- Search & Add Employee Button -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <input type="text" id="searchInput" class="form-control w-50" placeholder="Search Employees...">
    <a href="{{ url_for('add_employee') }}" class="btn btn-success fw-bold">
      <i class="fas fa-user-plus"></i> Add Employee
    </a>
  </div>

  <!-- Employee Table -->
  <div class="card shadow-lg p-4 border-0 rounded-4">
    <div class="table-responsive">
      <table class="table table-hover align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Profile</th>
            <th>Name</th>
            <th>Email</th>
            <th>Department</th>
            <th>Job Role</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="employeeTable">
          {% for employee in employees %}
          <tr>
            <td>{{ employee.id }}</td>
            <td>
              <img src="{{ employee.photo if employee.photo else 'https://via.placeholder.com/50' }}" 
                   alt="Profile" width="50" height="50" class="rounded-circle border">
            </td>
            <td class="fw-semibold">{{ employee.name }}</td>
            <td>{{ employee.email }}</td>
            <td>{{ employee.department.name }}</td>
            <td>{{ employee.job_role.name if employee.job_role else 'N/A' }}</td>
            <td>
              {% if employee.is_active %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-danger">Inactive</span>
              {% endif %}
            </td>
            <td>
              <a href="/update_employee_details/{{employee.id}}" class="btn btn-primary btn-sm"><i class="fas fa-edit"></i></a>
              <a href="#" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></a>
              <a href="/employee_details/{{employee.id}}" class="btn btn-warning btn-sm">More Details</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // Dark Mode Toggle Function
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
  }
  
  // Search Functionality
  document.getElementById("searchInput").addEventListener("keyup", function() {
    let filter = this.value.toLowerCase();
    let rows = document.getElementById("employeeTable").getElementsByTagName("tr");
    for (let row of rows) {
      let nameCell = row.getElementsByTagName("td")[2]; // Name Column
      if (nameCell) {
        let nameText = nameCell.textContent || nameCell.innerText;
        row.style.display = nameText.toLowerCase().includes(filter) ? "" : "none";
      }
    }
  });
</script>

<!-- Font Awesome Icons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
{% endblock body %}
